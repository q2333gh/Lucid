# Development Guide

## IDE Support

clangd behaves best when host-only compile commands are separated from the WASM toolchain flags. We now keep **two** databases:

- `compile_commands.json` (git-ignored, at the repo root): host Criterion build, consumed by clangd.
- `cdk-c/compile_commands_wasm.json`: WASM build info generated by the Python + Bear flow.

### Host compile database (clangd)

```bash
cd cdk-c
cmake -S test -B test/build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
ln -sf "$PWD/test/build/compile_commands.json" "$PWD/compile_commands.json"
# optional but recommended if you open the repo root in clangd/VS Code
ln -sf "$PWD/compile_commands.json" ../compile_commands.json
```

- `cmake ... -DCMAKE_EXPORT_COMPILE_COMMANDS=ON` emits the host `compile_commands.json` inside `cdk-c/test/build/`.
- The first `ln` keeps `cdk-c/compile_commands.json` stable for editors configured to look inside `cdk-c/`.
- The second `ln` mirrors that file back to the repo root so root-level workspaces still function; skip it if you never open the root folder.
- Re-run those commands whenever you clean `cdk-c/test/build/` or install new headers.

### WASM compile database (optional tooling)

Your existing Bear flow still works; just redirect its output so it does not overwrite the host database:

```bash
cd cdk-c
bear --output compile_commands_wasm.json python scripts/build.py --wasi --examples
```

The WASM JSON can still be consumed by custom tooling, but clangd ignores it by default. Adjust the Bear arguments however you likeâ€”the key point is to keep the host `compile_commands.json` untouched.

### Language Server

We recommend using **clangd 21** (or compatible version) as the language server for the best IDE experience:

- **clangd 21.1+**: Recommended for optimal compatibility and feature support
- **clang 21.1+**: Should match clangd version for best results

The project is configured to work with clangd 21. If you encounter issues with `-std=c11` or other compiler flags, ensure your clangd version matches your clang version.

**Installation**: See [Clang 21 Installation Guide](clang21-install.md) for quick setup instructions.

## Development Workflow

1. **Build the project** (see [Build Guide](build.md))
2. **Generate compile commands** for IDE support (command above)
3. **Run tests** (see [Test Guide](test.md))
4. **Make changes** and rebuild as needed

## Tips

- The `compile_commands.json` file is git-ignored, so regenerate it after pulling changes or modifying build configuration
- Use `--clean` flag before regenerating compile commands if you encounter stale entries